#!/bin/bash

REF="$(omarchy-version-branch)"

# Get remote SHA for the current branch
remote_sha=$(git -C "$OMARCHY_PATH" ls-remote origin "refs/heads/$REF" | awk '{print $1}')
if [[ -z "$remote_sha" ]]; then
  echo "Error: Could not retrieve remote SHA for $REF."
  exit 1
fi

# Get local SHA for the current branch
local_sha=$(git -C "$OMARCHY_PATH" rev-parse "$REF" 2>/dev/null)
if [[ -z "$local_sha" ]]; then
  echo "Error: Could not resolve local HEAD."
  exit 1
fi

if [[ "$local_sha" != "$remote_sha" ]]; then
  echo "Omarchy update available ($local_sha -> $remote_sha on $REF)"
  exit 0
else
  echo "Omarchy is up to date ($REF)"
  exit 1
fi
